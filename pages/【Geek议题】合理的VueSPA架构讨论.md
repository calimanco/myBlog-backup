## 前言

web前端发展到现代，已经不再是严格意义上的后端MVC的V层，它越来越向类似客户端开发的方向发展，已独立拥有了自己的MVVM设计模型。前后端的分离也使前端人员拥有更大的自由，可以独立设计客户端部分的架构。  

> 【科普】MVVM是Model-View-ViewModel的简写。它本质上就是MVC 的改进版。MVVM 就是将其中的View 的状态和行为抽象化，让我们将视图 UI 和业务逻辑分开。当然这些事 ViewModel 已经帮我们做了，它可以取出 Model 的数据同时帮忙处理 View 中由于需要展示内容而涉及的业务逻辑。

Vue作为现在流行的MVVM框架，也是本人平常业务中用得最多的框架。如何才能更合理、优雅的写VueSPA，是本人一直研究的课题，经过一年左右的思考和实践总结出本文。  
本文属于中高级实践讨论，不适合新手。  
本人个人的观点，不代表是最佳实践，欢迎大牛一起讨论，批评指正。  

## 工程搭建

秉着不重复造轮子的原则（其实就是懒），工程直接使用Vue2.0官方脚手架生成，使用最新webpack模板。与标准模板的主要差异：  

1.  增加了Sass预编译器
2.  增加了Vuex状态管理
3.  增加了Axios基础Ajax工具库

新增部分的安装请参考他们各自的文档，这里不赘述。  

## 项目结构

### 模拟需求

讨论架构前我们需要一个项目需求，这里简单模拟一个。  
需求点:3个一级页面，2个二级页面，底部的tabbar只在一级页面出现，首页、个人中心和登录页面是未登录也可以进入；财务和编辑个人信息是只有登录用户可见，简单原型如下：  

![原型][1]

### 开发目录

下面不讨论脚手架生成的部分目录，只聚焦src开发目录，依据原型我们可以大致规划出下面的目录：    

    ├── build
    ├── config
    ├── dist
    ├── src  开发目录
    │   ├── api  公共接口集
    │   ├── assets  资源目录
    │   │   ├── images  图片
    │   │   ├── scripts  第三方脚本
    |   |   └── styles  基础样式库
    │   ├── components  公共组件
    │   │   ├── common  一般通用组件
    │   │   ├── form  表单通用组件
    │   │   └── popup  弹出类通用组件
    │   │── config  项目配置
    │   │   ├── dev.env.js  开发模式配置
    │   │   ├── env.js  一般配置
    │   │   ├── modules.js  模块配置
    │   │   └── prod.env.js  生产模式配置
    │   │── mixin  用于vue文件混合的模板
    │   │── modules  模块
    │   │   ├── finance  财务模块
    │   │   │   ├── components  财务模块私有组件
    │   │   │   │   └── FinanceIndexItem.vue  财务模块首页里的条目项
    │   │   │   ├── pages  财务模块页面
    │   │   │   │   └── FinanceIndex.vue  财务模块首页
    │   │   │   ├── api.js  模块专用api
    │   │   │   ├── index.js  模块入口
    │   │   │   ├── Layout.vue  模块承载页
    │   │   │   └── router.js  模块内路由
    │   │   ├── home  首页模块（子目录同上）
    │   │   └── user  用户模块（子目录同上）
    │   │── pages  公共页面
    │   │   ├── Success.vue  公共状态管理模块
    │   │   └── NotFound.vue  用户模块（子目录同上）
    │   ├── router  路由管理
    │   ├── store  公共状态管理
    │   │   ├── modules  公共状态管理模块
    │   │   │   ├── com.js  通用状态
    │   │   │   └── user.js  用户状态
    │   │   └── index.js  公共状态管理入口
    │   └── utils  基础工具
    └── static

### 一些规范约定

根据本人个人开发经验总结的规范，不代表必须这么做。  

1.  所有vue组件都以大写字面开头的驼峰命名法命名，这样保持到模板代码上，可以便于区分开html的原生标签；  
2.  人为划分vue组件为“页面”和“页面上的组件”，原则上“页面上的组件”不发请求，不改变公共状态，全部通过事件交由“页面”完成，本人更倾向用˙集中管理。（其实vue中并没有页面概念）；  
3.  各个模块，包括路由管理、公共状态管理、接口集等都在目录下有个index.js的入口文件，方便引用；  
4.  基础工具内的工具使用函数式编程，做到可移植，不要对本项目产生依赖；  
5.  资源图片只在项目中保留小图（就是会被webpack处理成base64那些），大图应使用cdn，可以动态获取也可以把地址写到一个脚本里；  
6.  使用eslint使js代码符合Airbnb规范。  

## 问题场景及解决方案

### 细分模块实现按需打包

项目过程中常遇到要把原来的项目分开部署，或是组件间耦合、或是多人开发时组件冲突等问题。本人提出的解决办法是将项目细分成模块进行开发，如示例所示：划分了三个模块，首页模块、财务模块、用户模块，每个模块下各自有独立的组件和页面。  
这种方案的特点除了直观可见的目录结构清晰，其中Layout模块承载页、专用api和路由，也是一大优势。  

1、Layout模块承载页  
这个是为了让开发这个模块的程序员有类似根组件`<App>`的公共空间。从路由的角度来说，所有的模块内页面都是它的子路由。一般来说它只是个空的路由跳转页，当然你把模块的公共数据放这里也可以的，如下以示例的finance模块为例：  

```html
<template>
  <router-view/>
</template>
<script>
export default {
  name: 'finance',
  data(){
    return {
      money: 123;
    }
  }
};
</script>
```

[1]: https://nimokuri.github.io/myBlog-backup/assets/【Geek议题】合理的VueSPA架构讨论/1.png
